\section{Implementation}

This section will describe the design and engineering processes that were used while implementing our system, based on the requirements described above. In order to simplify and structure its description, the system will first be broken down into its different logical components.


\subsection{High-Level System Architecture}
The various requirements and corresponding program functionality of our system can be broken down into four main areas: the 7-segment display, the keypad, the ADC and the PWM timer. Despite the overall system having significant complexity, there is a very limited number of states for the overall system, with the transition between them being very well defined. A state diagram showing the three states, along with the name of their transitions can be seen in Figure \ref{fig:high_level_state_diagram}.


\begin{figure}[h]
\centering
\begin{tikzpicture}[shorten >=1pt,node distance=4cm,on grid,auto] 
   \node[state,initial] (sleep)  {$Sleep$}; 
   \node[state] (input_target)	[below right=of sleep]	{$Input$}; 
   \node[state] (match_voltage) 	[below left=of sleep]	{$Match $};
   \path[->] 
   		(sleep) edge [bend left] node {WakeUp()} (input_target)
        (input_target) edge node {Sleep()} (sleep)
        (input_target) edge [bend left] node {StartMatching()} (match_voltage)
        (input_target) edge [loop below] node {Reset()} ()
        (match_voltage) edge [bend left] node {Sleep()} (sleep)
        (match_voltage) edge node {Reset()} (input_target)
    ;  
\end{tikzpicture}
\caption{System high-level state diagram}
\label{fig:high_level_state_diagram}
\end{figure}




\begin{tabular}{ p{5cm} | p{5cm} | p{5cm}}
Sleep & Input & Match \\
\hline
% Sleep state description 
The sleep state is the initial state of the system. In this state, the only active component is the keypad thread. All other components (display, ADC, PWM timer) are turned off, in order to conserve energy. Whenever a keypress is detected, the system transitions into the 'input' state.
&
% Input state description
During the "input" state, the Keypad thread detects button presses and updates the target value accordingly, while the Display thread shows the current target value. The Keypad and Display threads are active, while the ADC and PWM timer are turned off. Whenever a valid voltage value is entered, the system transitions into the "match" state.
&
% Match state state description
When the system enters the "match" state, 
\\
\end{tabular}


\subsection{Display Thread}

\begin{figure}[h]
\centering

\begin{tikzpicture}[shorten >=1pt,node distance=3cm,on grid,auto] 
\node[state,initial] (off)  {$Off$};
\node[state] [below=of off] (digit_1) {$Digit\_1$};
\node[state] [left=of digit_1] (digit_0) {$Digit\_0$}; 
\node[state] [right=of digit_1] (digit_2) {$Digit\_2$};
\path[->]
	(off) edge node {$start\_display()$} (digit_0);
% adding a grey background
\begin{pgfonlayer}{background}
\filldraw [line width=4mm,join=round,black!10]
(digit_0.north  -| digit_2.east)  rectangle (digit_2.south  -| digit_0.west);
\end{pgfonlayer}
\end{tikzpicture}


\caption{Display thread state diagram}
\label{fig:display_state_diagram}
\end{figure}


\subsection{Keypad Thread}

\subsection{ADC Logic}

\subsection{PWM Timer}